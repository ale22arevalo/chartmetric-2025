import { Calendar } from "../../components/Calendar.js";

async function draw() {
  // parameters
  let dataUrl = "./data/T1-4.csv";
  let chartContainerId = "calendarHeatmap";
  let xKey = "CREATION_DATE";
  let yKey = "DAILY_TRACK_COUNT";
  /***********************
   *1. Access data
   ************************/

  let data = await d3.csv(dataUrl);

  // let data = [
  //   {
  //     Date: "2020-01-02T00:00:00.000Z",
  //     Open: 28638.970703,
  //     High: 28872.800781,
  //     Low: 28627.769531,
  //     Close: 28868.800781,
  //     "Adj Close": 28868.800781,
  //     Volume: 251820000,
  //   },
  //   {
  //     Date: "2020-01-03T00:00:00.000Z",
  //     Open: 28553.330078,
  //     High: 28716.310547,
  //     Low: 28500.359375,
  //     Close: 28634.880859,
  //     "Adj Close": 28634.880859,
  //     Volume: 239590000,
  //   },
  //   {
  //     Date: "2020-01-06T00:00:00.000Z",
  //     Open: 28465.5,
  //     High: 28708.019531,
  //     Low: 28418.630859,
  //     Close: 28703.380859,
  //     "Adj Close": 28703.380859,
  //     Volume: 252760000,
  //   },
  //   {
  //     Date: "2020-01-07T00:00:00.000Z",
  //     Open: 28639.179688,
  //     High: 28685.5,
  //     Low: 28565.279297,
  //     Close: 28583.679688,
  //     "Adj Close": 28583.679688,
  //     Volume: 258900000,
  //   },
  //   {
  //     Date: "2020-01-08T00:00:00.000Z",
  //     Open: 28556.140625,
  //     High: 28866.179688,
  //     Low: 28522.509766,
  //     Close: 28745.089844,
  //     "Adj Close": 28745.089844,
  //     Volume: 291750000,
  //   },
  //   {
  //     Date: "2020-01-09T00:00:00.000Z",
  //     Open: 28851.970703,
  //     High: 28988.009766,
  //     Low: 28844.310547,
  //     Close: 28956.900391,
  //     "Adj Close": 28956.900391,
  //     Volume: 275060000,
  //   },
  //   {
  //     Date: "2020-01-10T00:00:00.000Z",
  //     Open: 28977.519531,
  //     High: 29009.070313,
  //     Low: 28789.099609,
  //     Close: 28823.769531,
  //     "Adj Close": 28823.769531,
  //     Volume: 237830000,
  //   },
  //   {
  //     Date: "2020-01-13T00:00:00.000Z",
  //     Open: 28869.009766,
  //     High: 28909.910156,
  //     Low: 28819.429688,
  //     Close: 28907.050781,
  //     "Adj Close": 28907.050781,
  //     Volume: 249830000,
  //   },
  //   {
  //     Date: "2020-01-14T00:00:00.000Z",
  //     Open: 28895.5,
  //     High: 29054.160156,
  //     Low: 28872.269531,
  //     Close: 28939.669922,
  //     "Adj Close": 28939.669922,
  //     Volume: 287440000,
  //   },
  //   {
  //     Date: "2020-01-15T00:00:00.000Z",
  //     Open: 28901.800781,
  //     High: 29127.589844,
  //     Low: 28897.349609,
  //     Close: 29030.220703,
  //     "Adj Close": 29030.220703,
  //     Volume: 260270000,
  //   },
  //   {
  //     Date: "2020-01-16T00:00:00.000Z",
  //     Open: 29131.949219,
  //     High: 29300.320313,
  //     Low: 29131.949219,
  //     Close: 29297.640625,
  //     "Adj Close": 29297.640625,
  //     Volume: 252110000,
  //   },
  //   {
  //     Date: "2020-01-17T00:00:00.000Z",
  //     Open: 29313.310547,
  //     High: 29373.619141,
  //     Low: 29289.910156,
  //     Close: 29348.099609,
  //     "Adj Close": 29348.099609,
  //     Volume: 321820000,
  //   },
  //   {
  //     Date: "2020-01-21T00:00:00.000Z",
  //     Open: 29269.050781,
  //     High: 29341.210938,
  //     Low: 29146.470703,
  //     Close: 29196.039063,
  //     "Adj Close": 29196.039063,
  //     Volume: 320640000,
  //   },
  //   {
  //     Date: "2020-01-22T00:00:00.000Z",
  //     Open: 29263.630859,
  //     High: 29320.199219,
  //     Low: 29172.259766,
  //     Close: 29186.269531,
  //     "Adj Close": 29186.269531,
  //     Volume: 283440000,
  //   },
  //   {
  //     Date: "2020-01-23T00:00:00.000Z",
  //     Open: 29111.019531,
  //     High: 29190.470703,
  //     Low: 28966.980469,
  //     Close: 29160.089844,
  //     "Adj Close": 29160.089844,
  //     Volume: 307060000,
  //   },
  //   {
  //     Date: "2020-01-24T00:00:00.000Z",
  //     Open: 29230.390625,
  //     High: 29288.789063,
  //     Low: 28843.310547,
  //     Close: 28989.730469,
  //     "Adj Close": 28989.730469,
  //     Volume: 380010000,
  //   },
  //   {
  //     Date: "2020-01-27T00:00:00.000Z",
  //     Open: 28542.490234,
  //     High: 28671.789063,
  //     Low: 28440.470703,
  //     Close: 28535.800781,
  //     "Adj Close": 28535.800781,
  //     Volume: 337270000,
  //   },
  //   {
  //     Date: "2020-01-28T00:00:00.000Z",
  //     Open: 28594.279297,
  //     High: 28823.230469,
  //     Low: 28575.75,
  //     Close: 28722.849609,
  //     "Adj Close": 28722.849609,
  //     Volume: 330140000,
  //   },
  //   {
  //     Date: "2020-01-29T00:00:00.000Z",
  //     Open: 28820.529297,
  //     High: 28944.240234,
  //     Low: 28728.189453,
  //     Close: 28734.449219,
  //     "Adj Close": 28734.449219,
  //     Volume: 302290000,
  //   },
  //   {
  //     Date: "2020-01-30T00:00:00.000Z",
  //     Open: 28640.160156,
  //     High: 28879.710938,
  //     Low: 28489.759766,
  //     Close: 28859.439453,
  //     "Adj Close": 28859.439453,
  //     Volume: 326850000,
  //   },
  //   {
  //     Date: "2020-01-31T00:00:00.000Z",
  //     Open: 28813.039063,
  //     High: 28813.039063,
  //     Low: 28169.529297,
  //     Close: 28256.029297,
  //     "Adj Close": 28256.029297,
  //     Volume: 403890000,
  //   },
  //   {
  //     Date: "2020-02-03T00:00:00.000Z",
  //     Open: 28319.650391,
  //     High: 28630.390625,
  //     Low: 28319.650391,
  //     Close: 28399.810547,
  //     "Adj Close": 28399.810547,
  //     Volume: 307910000,
  //   },
  //   {
  //     Date: "2020-02-04T00:00:00.000Z",
  //     Open: 28696.740234,
  //     High: 28904.880859,
  //     Low: 28696.740234,
  //     Close: 28807.630859,
  //     "Adj Close": 28807.630859,
  //     Volume: 332750000,
  //   },
  //   {
  //     Date: "2020-02-05T00:00:00.000Z",
  //     Open: 29048.730469,
  //     High: 29308.890625,
  //     Low: 29000.849609,
  //     Close: 29290.849609,
  //     "Adj Close": 29290.849609,
  //     Volume: 357540000,
  //   },
  //   {
  //     Date: "2020-02-06T00:00:00.000Z",
  //     Open: 29388.580078,
  //     High: 29408.050781,
  //     Low: 29246.929688,
  //     Close: 29379.769531,
  //     "Adj Close": 29379.769531,
  //     Volume: 263700000,
  //   },
  //   {
  //     Date: "2020-02-07T00:00:00.000Z",
  //     Open: 29286.919922,
  //     High: 29286.919922,
  //     Low: 29056.980469,
  //     Close: 29102.509766,
  //     "Adj Close": 29102.509766,
  //     Volume: 252860000,
  //   },
  //   {
  //     Date: "2020-02-10T00:00:00.000Z",
  //     Open: 28995.660156,
  //     High: 29278.070313,
  //     Low: 28995.660156,
  //     Close: 29276.820313,
  //     "Adj Close": 29276.820313,
  //     Volume: 250510000,
  //   },
  //   {
  //     Date: "2020-02-11T00:00:00.000Z",
  //     Open: 29390.710938,
  //     High: 29415.390625,
  //     Low: 29210.470703,
  //     Close: 29276.339844,
  //     "Adj Close": 29276.339844,
  //     Volume: 279540000,
  //   },
  //   {
  //     Date: "2020-02-12T00:00:00.000Z",
  //     Open: 29406.75,
  //     High: 29568.570313,
  //     Low: 29406.75,
  //     Close: 29551.419922,
  //     "Adj Close": 29551.419922,
  //     Volume: 309530000,
  //   },
  //   {
  //     Date: "2020-02-13T00:00:00.000Z",
  //     Open: 29436.029297,
  //     High: 29535.400391,
  //     Low: 29345.929688,
  //     Close: 29423.310547,
  //     "Adj Close": 29423.310547,
  //     Volume: 291150000,
  //   },
  //   {
  //     Date: "2020-02-14T00:00:00.000Z",
  //     Open: 29440.470703,
  //     High: 29463.039063,
  //     Low: 29283.179688,
  //     Close: 29398.080078,
  //     "Adj Close": 29398.080078,
  //     Volume: 231000000,
  //   },
  //   {
  //     Date: "2020-02-18T00:00:00.000Z",
  //     Open: 29282.779297,
  //     High: 29330.160156,
  //     Low: 29116.810547,
  //     Close: 29232.189453,
  //     "Adj Close": 29232.189453,
  //     Volume: 256600000,
  //   },
  //   {
  //     Date: "2020-02-19T00:00:00.000Z",
  //     Open: 29312.699219,
  //     High: 29409.089844,
  //     Low: 29274.380859,
  //     Close: 29348.029297,
  //     "Adj Close": 29348.029297,
  //     Volume: 240640000,
  //   },
  //   {
  //     Date: "2020-02-20T00:00:00.000Z",
  //     Open: 29296.25,
  //     High: 29368.449219,
  //     Low: 28959.650391,
  //     Close: 29219.980469,
  //     "Adj Close": 29219.980469,
  //     Volume: 287780000,
  //   },
  //   {
  //     Date: "2020-02-21T00:00:00.000Z",
  //     Open: 29146.529297,
  //     High: 29146.529297,
  //     Low: 28892.699219,
  //     Close: 28992.410156,
  //     "Adj Close": 28992.410156,
  //     Volume: 311210000,
  //   },
  //   {
  //     Date: "2020-02-24T00:00:00.000Z",
  //     Open: 28402.929688,
  //     High: 28402.929688,
  //     Low: 27912.439453,
  //     Close: 27960.800781,
  //     "Adj Close": 27960.800781,
  //     Volume: 452580000,
  //   },
  //   {
  //     Date: "2020-02-25T00:00:00.000Z",
  //     Open: 28037.650391,
  //     High: 28149.199219,
  //     Low: 26997.619141,
  //     Close: 27081.359375,
  //     "Adj Close": 27081.359375,
  //     Volume: 513270000,
  //   },
  //   {
  //     Date: "2020-02-26T00:00:00.000Z",
  //     Open: 27159.460938,
  //     High: 27542.779297,
  //     Low: 26890.970703,
  //     Close: 26957.589844,
  //     "Adj Close": 26957.589844,
  //     Volume: 472450000,
  //   },
  //   {
  //     Date: "2020-02-27T00:00:00.000Z",
  //     Open: 26526,
  //     High: 26775.310547,
  //     Low: 25752.820313,
  //     Close: 25766.640625,
  //     "Adj Close": 25766.640625,
  //     Volume: 664980000,
  //   },
  //   {
  //     Date: "2020-02-28T00:00:00.000Z",
  //     Open: 25270.830078,
  //     High: 25494.240234,
  //     Low: 24681.009766,
  //     Close: 25409.359375,
  //     "Adj Close": 25409.359375,
  //     Volume: 915990000,
  //   },
  //   {
  //     Date: "2020-03-02T00:00:00.000Z",
  //     Open: 25590.509766,
  //     High: 26706.169922,
  //     Low: 25391.960938,
  //     Close: 26703.320313,
  //     "Adj Close": 26703.320313,
  //     Volume: 637200000,
  //   },
  //   {
  //     Date: "2020-03-03T00:00:00.000Z",
  //     Open: 26762.470703,
  //     High: 27084.589844,
  //     Low: 25706.279297,
  //     Close: 25917.410156,
  //     "Adj Close": 25917.410156,
  //     Volume: 647080000,
  //   },
  //   {
  //     Date: "2020-03-04T00:00:00.000Z",
  //     Open: 26383.679688,
  //     High: 27102.339844,
  //     Low: 26286.310547,
  //     Close: 27090.859375,
  //     "Adj Close": 27090.859375,
  //     Volume: 457590000,
  //   },
  //   {
  //     Date: "2020-03-05T00:00:00.000Z",
  //     Open: 26671.919922,
  //     High: 26671.919922,
  //     Low: 25943.330078,
  //     Close: 26121.279297,
  //     "Adj Close": 26121.279297,
  //     Volume: 477370000,
  //   },
  //   {
  //     Date: "2020-03-06T00:00:00.000Z",
  //     Open: 25457.210938,
  //     High: 25994.380859,
  //     Low: 25226.619141,
  //     Close: 25864.779297,
  //     "Adj Close": 25864.779297,
  //     Volume: 599780000,
  //   },
  //   {
  //     Date: "2020-03-09T00:00:00.000Z",
  //     Open: 24992.359375,
  //     High: 24992.359375,
  //     Low: 23706.070313,
  //     Close: 23851.019531,
  //     "Adj Close": 23851.019531,
  //     Volume: 750430000,
  //   },
  //   {
  //     Date: "2020-03-10T00:00:00.000Z",
  //     Open: 24453,
  //     High: 25020.990234,
  //     Low: 23690.339844,
  //     Close: 25018.160156,
  //     "Adj Close": 25018.160156,
  //     Volume: 654860000,
  //   },
  //   {
  //     Date: "2020-03-11T00:00:00.000Z",
  //     Open: 24604.630859,
  //     High: 24604.630859,
  //     Low: 23328.320313,
  //     Close: 23553.220703,
  //     "Adj Close": 23553.220703,
  //     Volume: 663960000,
  //   },
  //   {
  //     Date: "2020-03-12T00:00:00.000Z",
  //     Open: 22184.710938,
  //     High: 22837.949219,
  //     Low: 21154.460938,
  //     Close: 21200.619141,
  //     "Adj Close": 21200.619141,
  //     Volume: 911774226,
  //   },
  // ];
  data.forEach((element) => {
    element[xKey] = new Date(element[xKey]);
    element[yKey] = +element[yKey];
  });
  data = data.filter((d) => d[xKey].getFullYear() == 2023);
  console.log(d3.extent(data, (d) => d.DAILY_TRACK_COUNT))
  /***********************
   *2. Create chart dimensions
   ************************/
  // Get the element by its ID
  const visElement = document.getElementById(chartContainerId);

  // Get the bounding rectangle of the element
  const rect = visElement.getBoundingClientRect();
  let dimensions = {
    width: rect.width,
    height: rect.height,
    margin: {
      top: 0,
      right: 10,
      bottom: 0,
      left: 0,
    },
  };
  dimensions.boundedWidth =
    dimensions.width - dimensions.margin.left - dimensions.margin.right;
  dimensions.boundedHeight =
    dimensions.height - dimensions.margin.top - dimensions.margin.bottom;

  /***********************
   *3. Set up canvas
   ************************/
  // Create the SVG container.
  const wrapper = d3.select(visElement);

  const svg = wrapper
    .append("svg")
    .attr("width", dimensions.boundedWidth)
    .attr("height", dimensions.boundedHeight)
    .attr("viewBox", [0, 0, dimensions.boundedWidth, dimensions.boundedHeight])
    .attr("style", "max-width: 100%; height: 100%;");

  Calendar(svg, data, {
    x: (d) => d[xKey],
    y: (d) => d[yKey],
    weekday:"monday",
    width: dimensions.boundedWidth,
    colors:[  '#DFF3DB', '#CCEBC5','#8bc6fb'],
    cellSize: 30,
    paddingBetweenCells:5
  });
}

draw();
